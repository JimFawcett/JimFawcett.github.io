<!DOCTYPE html>
<html>
<head>
  <!--
   - CppStory_Libraries.html
   - ver 1.0 - 10 June 2019
   - Jim Fawcett, Emeritus Teaching Professor, Syracuse University
  -->
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <meta name="description" content="Software Projects. Code Samples. Software Links" />
  <meta name="keywords" content="Repository, Design, Code" />
  <meta name="Author" content="Jim Fawcett" />
  <meta name="Author" content="James Fawcett" />
  <title>C++ Story-TMP</title>
  <script src="js/ScriptsUtilities.js"></script>
  <script src="js/ScriptsTemplate.js"></script>
  <script src="js/ScriptsKeyboard.js"></script>
  <script src="js/ScriptsMenu.js"></script>
  <link rel="stylesheet" href="css/StylesTemplate.css" />
  <link rel="stylesheet" href="css/StylesDefault.css" />
  <link rel="stylesheet" href="css/StylesMenu.css" />
  <link rel="stylesheet" href="css/StylesBlueTheme.css" />
  <style>
    #github .pad10-15 {
      padding: 10px 15px;
    }

    #github .codeStyle {
      overflow: hidden;
      font-family: Consolas, monospace;
      font-weight: bold;
      font-size: 1.0em;
    }

    #github .labelStyle {
      font-family: sans-serif;
      /*font-weight:bold;*/
      font-size: 1.0em;
    }

    #github .normal {
      font-weight: normal;
      font-size: 1.0em;
      font-family: Tahoma;
    }

    #github summary {
      padding: 3px 0px 5px 0px;
      font-weight: bold;
      width: max-content;
    }

      #github summary ~ div {
        width: max-content;
        max-width: 95%;
      }

      #github summary ~ indent-block {
        width: max-content;
        max-width: 95%;
        padding-left: 20px;
        padding-right: 20px;
        /*background-color: #eee;*/
      }

    #github photosizer-block {
      position: relative;
      z-index: 2;
      background-color: white;
    }

    #github comment-block {
      width: max-content;
      max-width: 95%;
      padding: 10px 15px;
      background-color: #eee;
      font-weight: normal;
      font-size: 1.0em;
      font-family: Tahoma;
    }

    #github c-s {
      overflow: hidden;
      font-family: Consolas, monospace;
      font-weight: bold;
      font-size: 1.0em;
    }

    #github t-s {
      font-weight: normal;
      font-size: 1.0em;
      font-family: Tahoma;
    }

    #github .notice {
      font-size: 1.1em;
      font-weight: bolder;
      font-style: italic;
      font-family: Consolas, sans-serif;
      border: none;
      color: darkred;
    }

    #github background-block {
      display: block;
      background-color: #ddd;
      max-width: 90%;
      width: max-content;
      padding: 10px 15px;
    }

    #github .footnote {
      font-size: 0.85em;
    }

    #github ol.footnote li {
      padding-bottom: 0px;
    }
  </style>
</head>
<body id="github" onload="initializeMenu()">

  <navKeys-Container>
    <nav-Key id="sKey" onclick="toggleSwipeEvents()">S</nav-Key>
    <nav-Key id="rKey" onclick="location.reload()">R</nav-Key>
    <nav-Key id="tKey" onclick="scrollPageTop()">T</nav-Key>
    <nav-Key id="bKey" onclick="scrollPageBottom()">B</nav-Key>
    <nav-Key id="hKey" onclick="helpWin()">H</nav-Key>
    <nav-Key id="pKey" onclick="loadPrev()">P</nav-Key>
    <nav-Key id="nKey" onclick="loadNext()">N</nav-Key>
  </navKeys-Container>

  <nav>
    <div id="navbar"></div>
  </nav>

  <a id="Next" href="CppStory_Libraries.html">N</a>
  <a id="Prev" href="CppStory_Templates.html">P</a>

  <header>
    <hgroup id="pagetitle">
      <h1 id="title">Chapter #7 - TemplateMetaprogramming</h1>
      <h3 id="subtitle">Code Generators</h3>
    </hgroup>
  </header>
  <hr class="spread" />
  <bb-55 class="indent">
    <num-cont>
      <num-item1>7.0</num-item1><num-item4>Template Metaprogramming</num-item4>
    </num-cont>
    <t-b>
      Implementing C++ templates required compilers to develop a meta language that executes at compile-time.
      It manipulates types and constants to build function and class templates - entities that generate
      functions and classes, directed by types that are supplied by an application.
    </t-b>
    <t-b>
      The result is a two phase compilation process:
      <indent-block>
        <ol class="tight indent">
          <li>
            compile template code with unspecified template parameter <c-s>A</c-s>: 
            <indent-block class="pad5">
              <c-s>template&lt;class A&gt; class X { ... };</c-s>
            </indent-block>          </li>
          <li>compile instantiations of the template with a defined type <c-s>AppClass</c-s>: 
            <indent-block class="pad5">
              <c-s>X&ltAppClass&gt x;</c-s>
            </indent-block>
          </li>
        </ol>
      </indent-block>
      Template Metaprograms run during the second compilation phase.
    </t-b>
    <t-b class="indent">
      <details>
        <summary class="labelStyle lightItem">Quick Starter Example</summary>
        <div class="pad15">
          <a href="https://stackoverflow.com/questions/1198260/how-can-you-iterate-over-the-elements-of-an-stdtuple">
              stackoverflow source
          </a>
        </div>
        <bb-55 class="pad10">
          Like other functional languages, Template MetaProgramming (TMP) implements loops with
          recursion.  It has to do that because there are no variables at compile-time, e.g., no
          way to change a loop iterator&apos;s value.
        </bb-55>
        <s-halfEm></s-halfEm>
        <defn-outerblock>
          <defn-block>
            <defn-head>TMP Code: display items in a std::tuple</defn-head>
            <defn-code>
#include &lt;iostream&gt;
#include &lt;typeinfo&gt;
#include &lt;tuple&gt;
#include "../Display/Display.h"

namespace Chap7 {

  // recursive showTuple definition
  template&lt;size_t I = 0, typename... Tp&gt;
  void showTuple(std::tuple&lt;Tp...&gt;&amp; t) {
    std::cout &lt;&lt; std::get&lt;I&gt;(t) &lt;&lt; " ";    // get Ith item
    if constexpr (I + 1 != sizeof...(Tp))  // I = I + 1
      showTuple&lt;I + 1&gt;(t);
  }
}

// if constexpr (pred) { /* code to conditionally compile */ }
// - pred == true  => block is compiled so recurse
// - pred == false => block is not compiled, stops recursion
            </defn-code>
          </defn-block>
          <defn-block>
            <defn-head>Using code:</defn-head>
            <defn-code>
int main() {

  displayTitle("Demonstrate TMP");

  std::tuple t{ 1, 2.5, 'a', "a string" };
  std::cout &lt;&lt; "\n  ";
  Chap7::showTuple(t);

  std::cout &lt;&lt; "\n\n";
}
            </defn-code>
            <defn-head class="defnBorderTop">Output:</defn-head>
            <defn-code>
  Demonstrate TMP
=================  

  1 2.5 a a string
            </defn-code>
          </defn-block>
        </defn-outerblock>
        <s-1em></s-1em>
      </details>
    </t-b>
    <hr class="spread" />
    <num-cont>
      <num-item1>7.1</num-item1><num-item4>Variadic Functions</num-item4>
    </num-cont>
    <t-b>
      A variadic function takes an arbitrary
      finite number of arguments.  Variadic function templates build a sequence of functions one for each parameter
      arity, up to the largest number of arguments used in an application program.  Only those functions that are
      actually called are compiled into code in the second phase translation.
    </t-b>
    <t-b>
      Variadic functions are a classic Template MetaProgramming (TMP) construct. Each function is defined in terms of
      the function with one fewer arguments.  A template function overload for a single argument is provided, and C++
      guarantees that that specialization will be compiled if matched.  That specialization is used to stop
      recursion.
    </t-b>
    <details>
      <summary class="labelStyle darkItem">Example: Variadic Function displaying its arguments</summary>
      <s-halfEm></s-halfEm>
      <defn-outerBlock>
        <defn-block>
          <defn-head>Code: Variadic Function</defn-head>
          <defn-code>
#include &lt;iostream&gt;
#include &lt;string&gt;
#include "../Display/Display.h"

/*-- Helper function --*/

std::string strTrunc(
  const std::string&amp; src, size_t Max = 50
) {
  if (src.size() &gt; Max) {
    return src.substr(0, Max - 4) + " ...";
  }
  else {
    return src;
  }
}

/*-- Templ specializ'n stops recursive eval --*/

template&lt;typename T&gt;
void f(T t)
{
  std::cout &lt;&lt; "\n  " &lt;&lt; t &lt;&lt; " : "
    &lt;&lt; strTrunc(typeid(t).name(), 40)
    &lt;&lt; std::endl;
}

/*-- Recursive definition of template function --
   Args is a "parameter pack
   https://en.cppreference.com
*/
template&lt;typename T, typename... Args&gt;
void f(T t, Args... args)
{
  std::cout &lt;&lt; "\n  " &lt;&lt; t &lt;&lt; " : "
    &lt;&lt; typeid(t).name() &lt;&lt; std::endl;
  f(args...);
}
          </defn-code>
        </defn-block>
        <defn-block>
          <defn-head>Using Code</defn-head>
          <defn-code>
int main()
{
  std::cout &lt;&lt;
    "\n  Demonstrate Variatic Functions";
  std::cout &lt;&lt;
    "\n ================================\n";

  displayDemo("-- function with 5 args --\n");
  f(
    1, 3.5, 'z',
    "a literal string",
    std::string("a std::string")
  );
  putline();
  displayDemo("-- function with 2 args --\n");
  f('q', "only two args");

  std::cout &lt;&lt; "\n\n";
  return 0;
}
          </defn-code>
          <defn-head class="defnBorderTop">Output</defn-head>
          <defn-code>
 Demonstrate Variatic Functions
================================

 -- function with 5 args --

 1 : int

 3.5 : double

 z : char

 a literal string : char const *

 a std::string : 
   class std::basic_string&lt;char,struct  ...


 -- function with 2 args --

 q : char

 only two args : char const *
          </defn-code>
        </defn-block>
      </defn-outerBlock>
    </details>
    <hr class="spread" />
    <indent-block>
      <h3>C++ TMP:</h3>
      <h3>std functions</h3>
      std::ref, std::move, std::forward, std::apply, std::invoke, 
      <h3>Variatic Templates</h3>
      <h3>TypeTraits</h3>
      <h3>Compile-Time Selections</h3>
      <h3>Examples</h3>
      <indent-blocks>
      </indent-blocks>
      <hr class="spread" />
      <h3>References:</h3>
      <indent-block>
        <a href="https://github.com/AnthonyCalandra/modern-cpp-features#folding-expressions">modern-cpp-features AnthoneCalandra</a><br />
        <a href="https://www.amazon.com/Effective-Modern-Specific-Ways-Improve/dp/1491903996/ref=sr_1_1?crid=1CA7256H250RY&keywords=effective+modern+c%2B%2B+by+scott+meyers&qid=1578761973&s=books&sprefix=effective+moder%2Caps%2C152&sr=1-1">Effective Modern C++ - Scott Meyers</a><br />
        <a href="https://www.fluentcpp.com/2020/01/03/dry-comparisons-a-c-library-to-shorten-redundant-if-statements/">any_of</a><br />
        <a href="file:///C:/Users/jfawc/Downloads/from_metaprogramming_tricks_to_elegance__vincent_reverdy__cppcon_2018%20(1).pdf">Metaprogramming tricks to elegance</a><br />
        <a href="https://www.youtube.com/watch?v=PFdWqa68LmA&feature=youtu.be">video: Modern C++ Interfaces - Stephen Dewhurst</a>, 
        <a href="http://stevedewhurst.com/interfaces-Triangle-Developers-Group.pdf">slides</a>, 
        <a href="http://stevedewhurst.com">stevedewhurst.com</a><br />
        <a href="https://www.fluentcpp.com/2018/05/15/make-sfinae-pretty-1-what-value-sfinae-brings-to-code/">make sfinae pretty - part 1</a><br />
        
    </indent-block>
  </bb-55>
    <spacer-25></spacer-25>
    <!--<img class="strip-photo" src="Pictures/CampusAtNight.jpg" alt="campus at night" />-->

    <info-bar></info-bar>
</body>
</html>