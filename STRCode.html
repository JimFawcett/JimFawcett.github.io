<!DOCTYPE html>
<html>
<!--
  STRCode.html
-->
<head>
  <title>STRCode</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/StylesPageFrameDefaults.css" />
  <link rel="stylesheet" href="css/StylesPageFrameStructure.css" />
  <link rel="stylesheet" href="css/StylesPageFrameMenus.css" />
  <link rel="stylesheet" href="css/StylesPageFrameThemeBlue.css" />
  <link rel="stylesheet" href="css/StylesWebComponents.css" />
  <script src="js/ScriptsWebComponents.js"></script>
  <script src="js/ScriptsPageFrameCppRepos.js"></script>
  <script src="js/ScriptsPageFramePagesCppRepos.js"></script>
  <script src="js/ScriptsPageFrameKeyboard.js"></script>
  <style>
    summary {
      padding: 3px 0px 5px 0px;
    }

    .container {
      display: grid;
      grid-template-columns: 0em 0.6fr 1.5fr 0.6fr 1fr 0em;
      /*link to pg, descrip, link to repo, status grid-column-gap: 0em;*/
      padding: 0.0em;
      margin: 0em 0.25em 1em 0.25em;
      border: 1px solid var(--dark);
    }

    .item1 {
      grid-column: 2;
      padding: 0.2em 1em;
      border: 2px solid var(--dark);
    }

    .item2 {
      grid-column: 3;
      padding: 0.2em 1em;
      border: 2px solid var(--dark);
    }

    .item3 {
      grid-column: 4;
      padding: 0.2em 1em;
      border: 2px solid var(--dark);
    }

    .item4 {
      grid-column: 5;
      padding: 0.2em 1em;
      border: 2px solid var(--dark);
    }

    .gray {
      background-color: #ddd;
    }

    .spread {
      margin: 1em;
    }

    .tightSpread {
      margin: 0.5em;
    }
    #github #pagetitle {
      background-color:var(--dark);
      color: var(--light);
    }

    #github #title {
      background-color: var(--dark);
      color: var(--light);
    }

    #github #subtitle {
      background-color: var(--dark);
      color: var(--light);
    }

    #github a.repoLink {
      background-color: var(--dark);
      color: var(--light);
    }
    #github h3 {
      margin-top: 1.0em;
      margin-bottom: 0.75em;
    }
    #github h4 {
      margin-top: 0.75em;
      margin-bottom: 0.75em;
    }
    #github indent-block {
      padding:0.5em 0em;
    }
  </style>
</head>
<body id="github" onload="initialize()" style="position:relative;">

  <!--<a id="Next" href="CompoundObjects.html">N</a>
  <a id="Prev" href="CppBasicDemos.html">P</a>-->

  <page-frame>
    <frame-header>
      <nav id="navbar"></nav>
    </frame-header>
    <main>
      <div id="about">about</div>
      <div id="modified">12/06/2022</div>
      <div id="page">STRCode</div>
      <div id="hlp"></div>
      <a id="top"></a>
      <content>
  <header>
    <!--<a class="repoLink" href="STR.html">STR code</a>-->
    <hgroup id="pagetitle">
      <h1 id="title">Str Code Analysis</h1>
      <h3 id="subtitle" class="indent">All the implementation details for a value type</h3>
    </hgroup>
  </header>

  <!--<page-note onclick="hidePageNote()">
    Explains declaration, definition, and invocation for each member function.
  </page-note>-->
  <indent-blocks>
     <div class="right">
      <photosizer-block src="Pictures/STRClassDeclar.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
        <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
          <!--Fig 1. STR Class-->
        </span>
      </photosizer-block>
    </div>
    <t-b>
      <a href="STR.html">STR.html</a>
    </t-b>
    <h3 id="class">1.0 Str - String Class</h3>
    <t-b>
      The Str class represents null terminated strings.  I wrote the code for this class before there was a
      std::string class.  You should, of course, use the std::string class.  However, Str is a really nice
      tool to illustrate how value types are created.
    </t-b>
    <t-b>
      Value types are instances of classes that can be copied and assigned.  When a copy or assignment operation
      completes, there are two unique instances of STR, each with the same state values.  But these states are
      independent.  Should the destination of a copy or assignment change its state, that does not affect, in any
      way the state of the source Str instance.
    </t-b>
    <t-b>
      This is achieved by careful implementation of copy, move, and assignment operations. Each of the items,
      below, shows how to implement every one of the Str class methods and a couple of global functions associated
      with the class, e.g., Str insertion and extraction operators.
    </t-b>
    <t-b>
      For each method in the Str class, declared in Figure 1, we show, in the following items, how to declare,
      implement, and invoke the method.
    </t-b>
    <div class="clear"></div>
    <h3 id="methods">2.0 Str Methods</h3>
    <details>
      <summary><span>Str Default Constructor</span></summary>
      <div style="position:relative; top:-3em;" class="right">
      <photosizer-block src="Pictures/STRDefaultCtor.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
        <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
          <!--Fig 1. STR Class-->
        </span>
      </photosizer-block>
    </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      Str default constructor initializes an instance of Str with no arguments.  This might be used, for example,
      to construct an array of Str instances.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Copy Constructor</summary>
      <div style="position:relative; top:-3em;" class="right">
      <photosizer-block src="Pictures/STRCopyCtor.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
        <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
          <!--Fig 1. STR Class-->
        </span>
      </photosizer-block>
    </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      Copy constructors play an important role in developing value types, since copying is an essential feature
      for them. Every time we pass a method or function argument by value, we make a copy of the instance on the
      functions stack frame.  The same is true for return by value, and any code that explicitly invokes a copy.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Move Constructor</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRMoveCtor.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      Move constructors allow the compiler to avoid making copies when the source of the copy is a temporary
      instance. A properly designed move constructor will take ownership of the temporary&apos;s state, possibly
      invalidating the temporary object.  That is not a problem as long as a move is the last thing that happens
      before the temporary goes out of scope.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Promotion Constructor</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRPromoCtor.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      Promotion constructors take a single argument of some other type, causing a conversion of the source type
      to the destination type. Essentially the promotion constructor is just using information contained in the
      source to build a new Str instance. For STR, we define a promotion from literal strings to Str instances.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Destructor</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRDtor.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      Every class must have a destructor, either defined by the class, or implemented by the compiler.  For STR
      instances, that just deallocates their character storage from the native heap.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Copy Assignment Operator</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRCopyAssign.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      Copy assignment changes the state of an existing instance to match the state of a source instance.
      After copy assignment no changes have been made to the source.  The states of the two instances,
      source and destination, have the same values but are stored independently.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Move Assignment Operator</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRMoveAssign.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      The idea of move assignment is very like move construction.  The only significant difference is that
      with move construction we are building a new instance, while with move assignment we transfer ownership
      of the source&apos;s state to the destination.  When compiling an assignment expression, the compiler
      will use copy assignment if the source is a named object that will remain in scope.  If the source is
      a temporary object, the compiler will use move assignment.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Index Operator</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRIndexOper.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      An index operator is used to access one item of a collection, usually stored as a private member
      of the class.  For non-const indexers, the index operator can be used to both read and write the item.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Const Index Operator</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRIndexOperConst.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      A const index operator is used to access one item of a collection for reading, usually stored as a private member
      of the class. This allows indexing a const instance of a class that provides this operator.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Append a Character</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRAppendChar.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      The character append operation is a bit complicated, because the Str instance may, or may not, have unallocated
      memory to store the character in its char array.  We have to check the space available and based on the result
      either store in the original array, or create a larger temporary array, copy the original characters, append the
      new one, deallocate the original array, and attach the new one to the instance.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Append a String</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRAppendStr.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      This operation is very similar to the preceeding one, but now we check for space for the string.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Addition Operator</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRAdd.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      Having implemented the Append operations, implementation of the Addion operator is almost trivial.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Cast Operator</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRCast.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      Casts create an instance of a new type based on information stored in the source type.
      For Str instances that simply returns a const pointer to its internal character storage,
      e.g., it returns a const literal string.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Insertion Operator</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRInsertionOper.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      Insertion operators have to be implemented as global functions.  For STR, the insertion simply
      streams its characters to the output stream, specified in its calling parameters.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Str Extraction Operator</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRExtractOper.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      Extraction could be complicated because we are streaming in from a source for which we have no
      size information.  However, because we already implemented the character append operation, which
      takes care of ensuring adequate storage, we simply append characters from the source stream.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Coersions</summary>
       <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRCoercions.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      Coercions happen when a compiler applies a promotion constructor or cast operator to
      create an instance of a different type than the source of the coercion.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Binary Operator Model</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRBinaryOper.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      Binary operators can be defined either as class members or global functions.  This item
      discusses the syntax for doing that.
    </indent-block>
    <spacer-15></spacer-15>
    <details>
      <summary>Expression Model</summary>
      <div style="position:relative; top:-3em;" class="right">
        <photosizer-block src="Pictures/STRExpressions.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
            <!--Fig 1. STR Class-->
          </span>
        </photosizer-block>
      </div>
    </details>
    <indent-block class="t-b" style="margin-left:20px;">
      When the compiler scans a C++ expression it looks for type mismatches.  If it finds any, it
      will try to find a cast or promotion operation to resolve the mismatch.  If it finds one
      non-ambiguous way to resolve the types, it applies that way, otherwise compilation fails.
    </indent-block>
    <t-b>
      This design is fairly large and, in a few places, a bit complicated. However, the result is that
      we can use instances of Str to represent strings, just as if they were of a type defined
      by the C++ language.  We can copy them, assign them, index them, ..., without participating in
      the instance&apos;s resource management.
    </t-b>
    <t-b>
      The result is that the designer had to spend a lot of time getting all the details defined
      correctly, but users simply using the class without having any knowledge about its design
      other than its class interface.
    </t-b>
    <spacer-15></spacer-15>

  </indent-blocks>
    <div style="height:20em;"></div>
      </content>
      <a id="bottom"></a>
      <!--<page-TOC id="pages" style="display:none;">
      </page-TOC>-->
      <page-sections id="sections" style="display:none;">
        <sec-elem style="width:0.0em">&nbsp;</sec-elem>
        <menu-elem class="secElem"><a href="#bottom">bottom</a></menu-elem>
        <!--<menu-elem class="secElem"><a href="#res">res</a></menu-elem>-->
        <menu-elem class="secElem"><a href="#methods">STR Methods</a></menu-elem>
        <!--<menu-elem class="secElem"><a href="#status">status</a></menu-elem>-->
        <!--<menu-elem class="secElem"><a href="#build">build</a></menu-elem>-->
        <!--<menu-elem class="secElem"><a href="#impl">impl</a></menu-elem>-->
        <!--<menu-elem class="secElem"><a href="#struct">struct</a></menu-elem>-->
        <!--<menu-elem class="secElem"><a href="#design">design</a></menu-elem>-->
        <!--<menu-elem class="secElem"><a href="#oper">oper</a></menu-elem>-->
        <!--<menu-elem class="secElem"><a href="#concept">concept</a></menu-elem>-->
        <menu-elem class="secElem"><a href="#class">STR class</a></menu-elem>
<!--        <menu-elem class="secElem"><a href="#contents">contents</a></menu-elem>-->
        <menu-elem class="secElem"><a href="#top">top</a></menu-elem>
      </page-sections>
    </main>
    <frame-footer>
      <menu-item style="width:1.0em;">&nbsp;</menu-item>
      <menu-elem id="nextLink2" onclick="bottomMenu.next()">Next</menu-elem>
      <menu-elem id="prevLink2" onclick="bottomMenu.prev()">Prev</menu-elem>
      <menu-elem id="pgbtn" onclick="bottomMenu.pages()">Pages</menu-elem>
      <menu-elem onclick="bottomMenu.sections()">Sections</menu-elem>
      <menu-elem onclick="bottomMenu.about()">About</menu-elem>
      <menu-elem id="kysbtn" onclick="storyHlpMenu.keys()">Keys</menu-elem>
      <!--<menu-item style="width:1.0em;">&nbsp;</menu-item>
      <menu-elem style="font-size:0.75em;" onclick="storyHlpMenu.decrZoomScreen()">Zout</menu-elem>
      <menu-elem style="font-size:0.75em;" onclick="storyHlpMenu.normZoomScreen()">Zdef</menu-elem>
      <menu-elem style="font-size:0.75em;" onclick="storyHlpMenu.incrZoomScreen()">Zin</menu-elem>-->
    </frame-footer>
  </page-frame>
</body>
</html>